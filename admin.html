<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - BEA Canteen</title>
  <link rel="icon" type="image/png" href="bealogo.png">
  <link rel="stylesheet" href="style.css">
  <style>
    .admin-container { max-width: 800px; margin: 20px auto; background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .order-card { border: 2px solid #eee; border-radius: 8px; padding: 15px; margin-bottom: 20px; position: relative; }
    .order-header { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding-bottom: 10px; margin-bottom: 10px; }
    .order-img { width: 150px; border-radius: 5px; margin-top: 10px; border: 1px solid #ddd; }
    .status-badge { background: #ff8c69; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px; }
    .complete-btn { background: #2c7a2c; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
    .complete-btn:hover { background: #235d23; }
  </style>
</head>
<body>

<nav class="navbar">
  <div class="nav-logo">Admin Panel</div>
  <button onclick="exitAdmin()" class="logout-link">Back to Menu</button>
</nav>

<script>
  function exitAdmin() {
      // Remove the admin "key" before leaving
      sessionStorage.removeItem("adminAuthenticated");
      window.location.href = "index.html";
  }
</script>

<div class="admin-container">
  <h2>Pending Orders</h2>
  <div id="admin-order-list">
    </div>
</div>

<script>
window.onload = function() {
    // 1. ADMIN SESSION GATEKEEPER
    // This checks if we are already logged in for this session
    let isAuthenticated = sessionStorage.getItem("adminAuthenticated");

    if (!isAuthenticated) {
        const password = prompt("Enter Admin Password:");
        if (password === "BEA123") {
            // Save authentication ONLY for this session
            sessionStorage.setItem("adminAuthenticated", "true");
        } else {
            alert("Access Denied");
            window.location.href = "index.html";
            return;
        }
    }

    // 2. LOAD ORDERS (Your existing logic)
    const orderList = document.getElementById('admin-order-list');
    const name = localStorage.getItem("studentName") || "Unknown User";
    const orderData = JSON.parse(localStorage.getItem("latestOrder"));
    const total = localStorage.getItem("latestTotal");
    const day = localStorage.getItem("selectedOrderDay") || "Today";
    const serviceTime = localStorage.getItem("latestServiceTime") || "N/A";

    if (orderData && orderData.length > 0) {
      let itemsHtml = orderData.map(item => `<li>${item.qty}x ${item.name}</li>`).join('');
      
      orderList.innerHTML = `
        <div class="order-card" id="active-order">
          <div class="order-header">
            <div>
              <strong>Student:</strong> ${name} <br>
              <strong>Day:</strong> ${day} | <strong>Time:</strong> ${serviceTime}
            </div>
            <span class="status-badge" id="status-text">Pending</span>
          </div>
          <div>
            <strong>Items:</strong>
            <ul>${itemsHtml}</ul>
            <p><strong>Total:</strong> <span style="color:#2c7a2c; font-weight:bold;">${total}</span></p>
          </div>
          <button class="complete-btn" onclick="markComplete()">MARK AS COMPLETE</button>
        </div>
      `;
    } else {
      orderList.innerHTML = "<p>No pending orders.</p>";
    }
    const paymentInfo = localStorage.getItem("paymentDetails") || "No Payment Info";
// Add this inside the template string:
<p><strong>Payment:</strong> ${paymentInfo}</p>
};

function markComplete() {
    document.getElementById('status-text').innerText = "Completed";
    document.getElementById('status-text').style.background = "#2c7a2c";
    
    // Clear order from storage
    localStorage.removeItem("latestOrder");
    localStorage.removeItem("latestTotal");
    
    alert("Order Completed!");
    location.reload(); // Reloads page, but won't ask for password because of sessionStorage
}
</script>
</body>
</html>