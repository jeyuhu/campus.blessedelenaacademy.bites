<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>School Canteen</title>
	<link rel="icon" type="image/png" href="bealogo.png">
  <link rel="stylesheet" href="style.css">
   <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>

<nav class="navbar">
  <div class="nav-logo" onclick="window.location.href='index.html'" style="cursor:pointer;">BEA Canteen</div>
  <ul class="nav-links" style="list-style:none; display:flex; gap:15px; font-size:13px; align-items:center;">
    <li onclick="window.location.href='about.html'" style="cursor:pointer;">About</li>
    <li onclick="window.location.href='service.html'" style="cursor:pointer;">Services</li>
    <li onclick="window.location.href='help.html'" style="cursor:pointer;">Help</li>
    <li onclick="window.location.href='contact.html'" style="cursor:pointer;">Contact</li>
    <li onclick="window.location.href='dayselection.html'" style="cursor:pointer;">Change Day</li>
    <li onclick="window.location.href='reviewpage.html'" style="cursor:pointer;">Reviews</li>
  </ul>
  <div class="user-profile">
    <img src="speedpfp.jpg" class="profile-icon">
    <span id="display-name">Guest</span>
    <button onclick="logout()" class="logout-link">Logout</button>
  </div>
</nav>

<div class="container">
  <h2>Food Menu</h2>
  <div style="text-align: center; margin-bottom: 10px;">
    <span id="current-day-display" style="background: #ff8c69; color: white; padding: 3px 10px; border-radius: 15px; font-size: 12px; font-weight: bold;">
      Day: Loading...
    </span>
  <form action="checkout.html">

    <div class="food-item">
      <input type="checkbox" id="adobo">
      <img src="adobo.jpg" alt="Adobo">
      <label for="adobo">Adobo</label>
      <span class="price">₱40.00</span>
      <div class="qty-box">
        <label>Qty:</label>
        <select><option>1</option><option>2</option><option>3</option></select>
      </div>
    </div>

    <div class="food-item">
      <input type="checkbox" id="friedchicken">
      <img src="friedchicken.jpg" alt="Chicken">
      <label for="friedchicken">Fried Chicken</label>
      <span class="price">₱30.00</span>
      <div class="qty-box">
        <label>Qty:</label>
        <select><option>1</option><option>2</option><option>3</option></select>
      </div>
    </div>

    <div class="food-item">
      <input type="checkbox" id="rice">
      <img src="rice.jpg" alt="Rice">
      <label for="rice">Rice</label>
      <span class="price">₱15.00</span>
      <div class="qty-box">
        <label>Qty:</label>
        <select><option>1</option><option>2</option><option>3</option></select>
      </div>
    </div>

<div class="food-item">
      <input type="checkbox" id="chaofan">
      <img src="chaofan.jpg" alt="Chaofan">
      <label for="chaofan">Chaofan</label>
      <span class="price">₱25.00</span>
      <div class="qty-box">
        <label>Qty:</label>
        <select><option>1</option><option>2</option><option>3</option></select>
      </div>
    </div>

<div class="food-item">
      <input type="checkbox" id="hotdog">
      <img src="hotdog.jpg" alt="Hotdog">
      <label for="hotdog">Hotdog</label>
      <span class="price">₱20.00</span>
      <div class="qty-box">
        <label>Qty:</label>
        <select><option>1</option><option>2</option><option>3</option></select>
      </div>
    </div>

<div class="food-item">
      <input type="checkbox" id="maling">
      <img src="maling.jpg" alt="Maling">
      <label for="maling">Maling</label>
      <span class="price">₱20.00</span>
      <div class="qty-box">
        <label>Qty:</label>
        <select><option>1</option><option>2</option><option>3</option></select>
      </div>
    </div>

<div class="food-item">
      <input type="checkbox" id="Fried Egg">
      <img src="friedegg.jpg" alt="Fried Egg">
      <label for="friedegg">Fried Egg</label>
      <span class="price">₱15.00</span>
      <div class="qty-box">
        <label>Qty:</label>
        <select><option>1</option><option>2</option><option>3</option></select>
      </div>
    </div>

    <div class="summary">
      <h3>Your Selection</h3>
      <div id="summary-list"></div>
      <div style="display: flex; justify-content: space-between; font-weight: bold; margin-top: 10px; border-top: 1px solid #ddd; padding-top: 10px;">
        <span>Total:</span>
        <span id="total-price">₱0.00</span>
      </div>
    </div>

  <div class="payment-section">
  <h3>Mode of Payment</h3>

  <label class="payment-option">
    <input type="radio" name="pay" value="cash" checked> Cash
  </label>

<div class="online-payment-container">
  <input type="radio" name="pay" value="online" id="online-trigger"> 
  <label for="online-trigger" class="payment-label">Online Payment</label>

  <div class="online-options">
    <label class="online-item">
      <input type="radio" name="sub-pay" value="gcash"> 
      <img src="gcash.jpg" alt="GCash"> GCash
    </label>
    <label class="online-item">
      <input type="radio" name="sub-pay" value="maya"> 
      <img src="maya.jpg" alt="Maya"> Maya
    </label>
  </div>
    <div class="payment-number">
      <label class="payment-label" for="payment-id">Enter GCash/Maya Number:</label>
      <input type="text" id="payment-id" name="payment-id" placeholder="09XXXXXXXXX" style="width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;">
    </div>
</div>    


<div class="service-selection" style="margin-top: 20px; padding: 10px; background: #f0f7ff; border-radius: 5px; border: 1px solid #d0e3ff;">
  <h3 style="font-size: 16px; margin-bottom: 8px;">Service Time</h3>
  <p style="font-size: 13px; color: #555; margin-bottom: 10px;">When would you like this order to be served?</p>
  
  <select name="service_time" required style="width: 100%; padding: 10px; border-radius: 4px; border: 1px solid #ccc;">
    <option value="" disabled selected>Select Service Time...</option>
    <option value="recess">Recess Time</option>
    <option value="lunch">Lunch Time</option>
  </select>
</div>

</div>

    <button type="submit" class="checkout-btn">CHECK OUT</button>
  </form>
</div>

<script>

  window.addEventListener('load', function() {
    const name = localStorage.getItem("studentName");
    const isLoggedIn = localStorage.getItem("isLoggedIn");
    const displayName = document.getElementById("display-name");

    // Protection: If not logged in, kick back to login page
    // (We skip this check if we are already on login.html)
    if (!isLoggedIn && !window.location.href.includes("login.html")) {
        window.location.href = "login.html";
    }

    // Update the name in the navbar if the element exists
    if (displayName && name) {
        displayName.innerText = name;
    }
});

// 2. Universal Logout Function
function logout() {
    localStorage.clear(); // Clear all session data (name, login status, order)
    window.location.href = "login.html";
}
  // Login Gatekeeper
  window.onload = function() {
    // 1. Check if the 'isLoggedIn' key exists in the browser storage
    const loggedIn = localStorage.getItem("isLoggedIn");

    // 2. If it's not there, redirect to login.html immediately
    if (!loggedIn) {
        window.location.href = "login.html";
    } else {
        // Optional: Display the student's name if they are logged in
        const name = localStorage.getItem("studentName");
        document.getElementById("display-name").innerText = name || "Student";
    }
};
  // Price Calculator
  const form = document.querySelector('form');
  form.addEventListener('change', () => {
    let total = 0;
    const summaryList = document.getElementById('summary-list');
    summaryList.innerHTML = "";
    
    document.querySelectorAll('.food-item').forEach(item => {
      const checkbox = item.querySelector('input[type="checkbox"]');
      if (checkbox.checked) {
        const name = item.querySelector('label').innerText;
        const price = parseFloat(item.querySelector('.price').innerText.replace('₱', ''));
        const qty = parseInt(item.querySelector('select').value);
        const itemTotal = price * qty;
        total += itemTotal;

        summaryList.innerHTML += `<p style="font-size:14px; margin:5px 0;">• ${name} x${qty} <span style="float:right;">₱${itemTotal.toFixed(2)}</span></p>`;
      }
    });
    document.getElementById('total-price').innerText = `₱${total.toFixed(2)}`;
  });

// ... your other code (price calculator, etc.) ...

  function logout() {
    // 1. Delete the login status
    localStorage.clear();
    
    // 2. Redirect the user back to the login page immediately
    window.location.href = "login.html";
  }
  // This function captures the data BEFORE the page changes
const orderForm = document.querySelector('form');
orderForm.addEventListener('submit', () => {
    let orderedItems = [];
    // Get the total text (e.g., "₱40.00")
    let total = document.getElementById('total-price').innerText;

    // Look through every food item to see what is checked
    document.querySelectorAll('.food-item').forEach(item => {
        const checkbox = item.querySelector('input[type="checkbox"]');
        if (checkbox.checked) {
            const name = item.querySelector('label').innerText;
            const qty = item.querySelector('select').value;
            const price = item.querySelector('.price').innerText;
            orderedItems.push({ name, qty, price });
        }
    });

    // Save the list and the total to localStorage
    localStorage.setItem("latestOrder", JSON.stringify(orderedItems));
    localStorage.setItem("latestTotal", total);
});
window.onload = function() {
    // Check login status
    const name = localStorage.getItem("studentName");
    if (!localStorage.getItem("isLoggedIn")) {
        window.location.href = "login.html";
    } else if (document.getElementById("display-name")) {
        document.getElementById("display-name").innerText = name;
    }
};

function logout() {
    localStorage.clear();
    window.location.href = "login.html";
}
</script>
</body>
</html>