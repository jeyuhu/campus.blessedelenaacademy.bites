<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Order Complete</title>
	<link rel="icon" type="image/png" href="bealogo.png">
<link rel="stylesheet" href="style.css">
</head>

<body>

<nav class="navbar">
  <div class="nav-logo" onclick="window.location.href='index.html'" style="cursor:pointer;">BEA Canteen</div>
  <ul class="nav-links" style="list-style:none; display:flex; gap:15px; font-size:13px; align-items:center;">
    <li onclick="window.location.href='about.html'" style="cursor:pointer;">About</li>
    <li onclick="window.location.href='service.html'" style="cursor:pointer;">Services</li>
    <li onclick="window.location.href='help.html'" style="cursor:pointer;">Help</li>
    <li onclick="window.location.href='contact.html'" style="cursor:pointer;">Contact</li>
    <li onclick="window.location.href='dayselection.html'" style="cursor:pointer;">Change Day</li>
    <li onclick="window.location.href='reviewpage.html'" style="cursor:pointer;">Reviews</li>
  </ul>
  <div class="user-profile">
    <img src="speedpfp.jpg" class="profile-icon">
    <span id="display-name">Guest</span>
    <button onclick="logout()" class="logout-link">Logout</button>
  </div>
</nav>

<div class="container">

  <h2>Order Complete</h2>

  <p class="complete-text">
    Your order is complete.<br>
    Please claim your food at the canteen.
  </p>
  <div id="order-receipt" style="background: #fffdf5; padding: 15px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 20px;">
  <h3 style="border-bottom: 2px solid #ff8c69; padding-bottom: 5px; margin-bottom: 10px;">Order Details</h3>
  <div id="receipt-items">
    </div>
  <div style="display: flex; justify-content: space-between; font-weight: bold; margin-top: 10px; font-size: 1.1em;">
    <span>TOTAL PAID:</span>
    <span id="receipt-total" style="color: #2c7a2c;">â‚±0.00</span>
  </div>
  <button onclick="window.print()" class="checkout-btn" style="background: #4A90E2; margin-bottom: 10px;">
  SAVE RECEIPT (PDF)
</button>
</div>

  <!-- QR PLACEHOLDER -->
  <div class="qr-box">
    <div></div><div></div><div></div><div></div><div></div>
    <div></div><div></div><div></div><div></div><div></div>
    <div></div><div></div><div></div><div></div><div></div>
    <div></div><div></div><div></div><div></div><div></div>
    <div></div><div></div><div></div><div></div><div></div>
  </div>

</div>
<div class="container" style="text-align: center; margin-top: 20px;">
  <h3>How was your food?</h3>
  <p style="font-size: 14px; color: #666; margin-bottom: 15px;">We'd love to hear your feedback!</p>
  
  <button onclick="window.location.href='reviewpage.html'" class="checkout-btn" style="background: #4A90E2;">
    REVIEW ORDER
  </button>
  
  <p style="margin-top: 20px;">
    <a href="index.html" style="color: #ff8c69; font-size: 14px;">Back to Menu</a>
  </p>
</div>
<script>
   window.addEventListener('load', function() {
    const name = localStorage.getItem("studentName");
    const isLoggedIn = localStorage.getItem("isLoggedIn");
    const displayName = document.getElementById("display-name");

    // Protection: If not logged in, kick back to login page
    // (We skip this check if we are already on login.html)
    if (!isLoggedIn && !window.location.href.includes("login.html")) {
        window.location.href = "login.html";
    }

    // Update the name in the navbar if the element exists
    if (displayName && name) {
        displayName.innerText = name;
    }
});
// 2. Universal Logout Function
function logout() {
    localStorage.clear(); // Clear all session data (name, login status, order)
    window.location.href = "login.html";
}
  // Login Gatekeeper
  window.onload = function() {
    // 1. Check if the 'isLoggedIn' key exists in the browser storage
    const loggedIn = localStorage.getItem("isLoggedIn");

    // 2. If it's not there, redirect to login.html immediately
    if (!loggedIn) {
        window.location.href = "login.html";
    } else {
        // Optional: Display the student's name if they are logged in
        const name = localStorage.getItem("studentName");
        document.getElementById("display-name").innerText = name || "Student";
    }
  };  
const form = document.querySelector('form');
window.onload = function() {
    // 1. Get the data saved by the index page
    const orderData = JSON.parse(localStorage.getItem("latestOrder"));
    const totalData = localStorage.getItem("latestTotal");
    const receiptContainer = document.getElementById("receipt-items");

    // 2. If data exists, display it
    if (orderData && orderData.length > 0) {
        receiptContainer.innerHTML = ""; // Clear the "No items" message
        orderData.forEach(item => {
            const p = document.createElement("p");
            p.style.margin = "8px 0";
            p.style.fontSize = "14px";
            p.innerHTML = `<strong>${item.qty}x</strong> ${item.name} <span style="float:right;">${item.price}</span>`;
            receiptContainer.appendChild(p);
        });
        document.getElementById("receipt-total").innerText = totalData;
    } else {
        receiptContainer.innerHTML = "<p>No items selected.</p>";
    }
};
window.onload = function() {
    const orderData = JSON.parse(localStorage.getItem("latestOrder"));
    const totalData = localStorage.getItem("latestTotal");
    const receiptContainer = document.getElementById("receipt-items");

    if (orderData && orderData.length > 0) {
        orderData.forEach(item => {
            const p = document.createElement("p");
            p.style.margin = "8px 0";
            p.style.fontSize = "14px";
            p.innerHTML = `<strong>${item.qty}x</strong> ${item.name} <span style="float:right;">${item.price}</span>`;
            receiptContainer.appendChild(p);
        });
        document.getElementById("receipt-total").innerText = totalData;
    } else {
        receiptContainer.innerHTML = "<p>No items found.</p>";
    }
};
</script>

</body>
</html>
